# Makefile : auto-generated by script xcc_lkm.sh

# To support cross-compiling for kernel modules:
# For architecture (cpu) 'arch', invoke make as:
# make ARCH=<arch> CROSS_COMPILE=<cross-compiler-prefix> 
ifeq ($(ARCH),arm)
    # *UPDATE* 'KDIR' below to point to the ARM Linux kernel source tree on your box
    KDIR ?= ~/rpi_work/kernel_rpi
else ifeq ($(ARCH),powerpc)
    # *UPDATE* 'KDIR' below to point to the PPC64 Linux kernel source tree on your box
    KDIR ?= ~/kernel/linux-4.9.1
else
   KDIR ?= /lib/modules/$(shell uname -r)/build 
endif

obj-m          += mmap_baddrv.o
EXTRA_CFLAGS   += -DDEBUG
#$(info Building for: ARCH= CROSS_COMPILE= EXTRA_CFLAGS=)

all:
	make -C $(KDIR) M=$(PWD) modules
install:
	make -C $(KDIR) M=$(PWD) modules_install
clean:
	make -C $(KDIR) M=$(PWD) clean
	rm -fv userspc_mmap 2>/dev/null

userspc_mmap: userspc_mmap.c
	gcc userspc_mmap.c -o userspc_mmap -Wall -O2
